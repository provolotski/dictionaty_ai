# Скрипты для запуска Dictionary AI

Этот набор скриптов предназначен для удобного управления приложением Dictionary AI, которое состоит из бэкенда на FastAPI и фронтенда на Django.

## Структура проекта

```
dictionaty_ai/
├── backend/          # FastAPI бэкенд
├── frontend/         # Django фронтенд
├── start_app.sh      # Скрипт запуска
├── stop_app.sh       # Скрипт остановки
├── status_app.sh     # Скрипт проверки статуса
└── logs/             # Директория для логов
```

## Требования

- Python 3.8+
- pip3
- bash

## Использование

### 1. Запуск приложения

```bash
./start_app.sh
```

Этот скрипт:
- Создает виртуальные окружения для бэкенда и фронтенда
- Устанавливает зависимости из `requirements.txt`
- Применяет миграции Django
- Запускает бэкенд на порту 8000
- Запускает фронтенд на порту 8001
- Создает лог-файлы в директории `logs/`

### 2. Альтернативный запуск (решает проблемы с Python 3.12)

```bash
./start_app_fallback.sh
```

Этот скрипт решает проблемы с `distutils` в Python 3.12:
- Устанавливает системные зависимости
- Использует альтернативные методы установки пакетов
- Устанавливает пакеты по одному для лучшего контроля

### 3. Остановка приложения

```bash
./stop_app.sh
```

Этот скрипт:
- Находит и останавливает процессы бэкенда и фронтенда
- Освобождает порты 8000 и 8001
- Выводит статус остановки

### 4. Проверка статуса

```bash
./status_app.sh
```

Этот скрипт:
- Проверяет, запущены ли процессы
- Тестирует доступность API и фронтенда
- Показывает информацию о портах
- Отображает размер лог-файлов

### 5. Исправление проблем с зависимостями

```bash
./fix_dependencies.sh
```

Этот скрипт решает проблемы с установкой зависимостей:
- Устанавливает системные зависимости (python3-distutils, python3-dev)
- Пересоздает виртуальные окружения
- Устанавливает пакеты по одному с обработкой ошибок
- Решает проблемы с `distutils` в Python 3.12

## Доступные URL

После запуска приложения будут доступны:

- **Фронтенд**: http://localhost:8001
- **Бэкенд API**: http://localhost:8000
- **API Документация**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## Логи

Логи приложений сохраняются в директории `logs/`:
- `logs/backend.log` - лог бэкенда
- `logs/frontend.log` - лог фронтенда

## Управление процессами

### Запуск в фоновом режиме

```bash
nohup ./start_app.sh > app.log 2>&1 &
```

### Просмотр логов в реальном времени

```bash
# Лог бэкенда
tail -f logs/backend.log

# Лог фронтенда
tail -f logs/frontend.log
```

### Принудительная остановка

Если обычная остановка не работает:

```bash
# Найти процессы
ps aux | grep -E "(uvicorn|manage.py)"

# Принудительно остановить
kill -9 <PID>
```

## Устранение неполадок

### Порт уже занят

Если порты 8000 или 8001 уже заняты:

```bash
# Найти процесс, использующий порт
lsof -i :8000
lsof -i :8001

# Остановить процесс
kill -9 <PID>
```

### Проблемы с зависимостями

Если возникают проблемы с установкой зависимостей:

```bash
# Использовать специальный скрипт для исправления
./fix_dependencies.sh

# Или вручную:
# Очистить кэш pip
pip cache purge

# Переустановить зависимости
cd backend && pip install -r requirements.txt --force-reinstall
cd ../frontend && pip install -r requirements.txt --force-reinstall
```

### Проблемы с Python 3.12 и distutils

Если вы используете Python 3.12 и возникают ошибки с `distutils`:

```bash
# Установить системные зависимости
sudo apt-get install python3-distutils python3-dev build-essential

# Использовать альтернативный скрипт запуска
./start_app_fallback.sh
```

### Проблемы с виртуальными окружениями

Для пересоздания виртуальных окружений:

```bash
# Удалить старые окружения
rm -rf backend/venv frontend/venv

# Запустить скрипт заново
./start_app.sh
```

## Автоматический запуск при загрузке системы

Для автоматического запуска при загрузке системы создайте systemd сервис:

```bash
sudo nano /etc/systemd/system/dictionary-ai.service
```

Содержимое файла:
```ini
[Unit]
Description=Dictionary AI Application
After=network.target

[Service]
Type=forking
User=your_username
WorkingDirectory=/path/to/dictionaty_ai
ExecStart=/path/to/dictionaty_ai/start_app.sh
ExecStop=/path/to/dictionaty_ai/stop_app.sh
Restart=always

[Install]
WantedBy=multi-user.target
```

Затем:
```bash
sudo systemctl daemon-reload
sudo systemctl enable dictionary-ai
sudo systemctl start dictionary-ai
```

## Безопасность

- Скрипты запускают приложения на `0.0.0.0` (доступно извне)
- Для продакшена рекомендуется настроить reverse proxy (nginx)
- Используйте HTTPS в продакшене
- Настройте файрвол для ограничения доступа к портам

## Поддержка

При возникновении проблем:
1. Проверьте логи в директории `logs/`
2. Убедитесь, что все зависимости установлены
3. Проверьте, что порты не заняты другими процессами
4. Убедитесь, что у вас есть права на создание виртуальных окружений
